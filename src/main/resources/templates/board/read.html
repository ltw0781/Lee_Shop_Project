<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="/css/reset.css"> -->
    <link rel="stylesheet" href="/css/style.css">
    <title>ê²Œì‹œíŒ ìƒì„¸</title>
</head>

<body>
    <!-- âœ… Main Content -->
    <main id="main">

        <div class="board-wrap inner">
            <div class="board-view">
                <form id="form" action="/board/delete" method="post">
                    <!-- CSRF TOKEN -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="no" th:value="${board.no}">
                    <!-- ì œëª© -->
                    <div class="board-title">
                        <span class="meta-category">ì¹´í…Œê³ ë¦¬ : <span th:text="${board.category}"></span></span>
                    </div>
                    <!-- ë©”íƒ€ ì •ë³´ -->
                    <div class="view-head">
                        <h3 th:text="${board.title}"></h3>
                        <div class="meta">
                            <span th:text="|ì‘ì„±ì : ${board.writer}|"></span>
                            <span th:text="|ë“±ë¡ì¼ : ${#dates.format(board.createdAt, 'yyyy-MM-dd')}" |></span>
                            <span th:text="|ì¡°íšŒìˆ˜ : ${board.viewCount}|"></span>
                        </div>
                    </div>
                    <!-- ë³¸ë¬¸ ë‚´ìš© -->
                    <div class="view-body">
                        <p th:text="${board.content}"></p>
                    </div>

                    <th:block th:each="file : ${fileList}">
                        <div>
                            <img th:src="|/img?id=${file.id}|" height="100" alt="íŒŒì¼ ì´ë¯¸ì§€">
                        </div>
                        <li>
                            <!-- íŒŒì¼ëª… (ë‹¤ìš´ë¡œë“œ) -->
                            <a th:href="|/file/${file.no}|" th:text="${file.originName}"></a>
                            <!-- íŒŒì¼ ì‚­ì œ -->
                            <button type="button" th:onclick="download( [[${file.id}]] )">ë‹¤ìš´ë¡œë“œ</button>
                            <button type="button" th:onclick="removeFile( this, [[${file.id}]] )">ì‚­ì œ</button>
                        </li>
                    </th:block>

                    <!-- ë²„íŠ¼ ì˜ì—­ -->
                    <div class="board-btns">
                        <button type="button" onclick="moveUpdate()" class="btn btn-primary">ìˆ˜ì •</button>
                        <button type="button" onclick="moveList()" class="btn btn-secondary">ëª©ë¡</button>
                        <button type="button" onclick="actionDelete()" class="btn btn-secondary">ì‚­ì œ</button>
                    </div>
                </form>
            </div>

        </div>
    </main>

    <script>

        let form = document.getElementById('form')

        // ğŸ‘©â€ğŸ’» ëª¨ë¸ ê°ì²´ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•
        let no = "[[${board.no}]]"

        // ìˆ˜ì • í™”ë©´ ì´ë™
        function moveUpdate() {
            location.href = '/board/update?no=' + no
        }

        // ë‹¤ìš´ë¡œë“œ
        function download(id) {
            location.href = `/file/${id}`
        }

        // íŒŒì¼ ëª©ë¡ ë¹„ë™ê¸° ìš”ì²­ 
        function getFileList() {
            let parentTable = 'board'
            let parentNo = '[[${board.no}]]'
            let url = `/file?parentTable=${parentTable}&parentNo=${parentNo}`

            let request = new XMLHttpRequest()

            request.onreadystatechange = function () {
                if (request.readyState == request.DONE && request.status == 200) {
                    console.log('íŒŒì¼ ëª©ë¡ ê°±ì‹  ì„±ê³µ');
                    let fileList = request.responseText
                    let $fileList = document.getElementById('file-list')
                    $fileList.innerHTML = ""        // ê¸°ë³¸ íŒŒì¼ ëª©ë¡ ë¹„ìš°ê¸°
                    $fileList.innerHTML = fileList  // ìƒˆë¡œ ì¡°íšŒí•œ íŒŒì¼ëª©ë¡ìœ¼ë¡œ ê°±ì‹ 
                }
            }
            request.open('GET', url, true)
            request.send()
        }

        // ì‚­ì œ ìš”ì²­
        function actionDelete() {
            let check = confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')
            if (check) {
                form.action = '/board/delete'
                form.submit()
            }
        }

        // ëª©ë¡ í™”ë©´ ì´ë™
        function moveList() {
            location.href = '/board/list'
        }
    </script>

</body>

</html>